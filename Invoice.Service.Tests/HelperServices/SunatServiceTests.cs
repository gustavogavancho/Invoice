using AutoFixture;
using Invoice.Entities.Models;
using Invoice.Service.HelperServices;
using System.Xml;
using UBLSunatPE;

namespace Invoice.Service.Tests.HelperServices;

public class SunatServiceTests
{
    private readonly Fixture _fixture;
    private readonly SunatService _sunatService;

    public SunatServiceTests()
    {
        _fixture = new Fixture();
        _sunatService = new SunatService();
    }

    [Fact]
    public void SunatService_SerializeXmlDocumentTest()
    {
        //Arrange
        var invoiceType = new InvoiceType
        {
            CustomizationID = new CustomizationIDType { Value = "2.0" },
            UBLVersionID = new UBLVersionIDType { Value = "2.1" },
        };

        var documentType = typeof(InvoiceType);

        //Act
        var sut = _sunatService.SerializeXmlDocument(documentType, invoiceType);

        //Assert
        Assert.NotNull(sut);
        Assert.Contains("2.0", sut);
    }

    [Fact]
    public void SunatService_SignXmlTest()
    {
        //Arrange
        var xml = "<?xml version=\"1.0\" encoding=\"utf-16\"?><Invoice xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:cac=\"urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2\" xmlns:cbc=\"urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2\" xmlns:ccts=\"urn:un:unece:uncefact:documentation:2\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:ext=\"urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2\" xmlns:qdt=\"urn:oasis:names:specification:ubl:schema:xsd:QualifiedDatatypes-2\" xmlns:udt=\"urn:un:unece:uncefact:data:specification:UnqualifiedDataTypesSchemaModule:2\" xmlns=\"urn:oasis:names:specification:ubl:schema:xsd:Invoice-2\"><ext:UBLExtensions><ext:UBLExtension /></ext:UBLExtensions><cbc:UBLVersionID>2.1</cbc:UBLVersionID><cbc:CustomizationID>2.0</cbc:CustomizationID><cbc:ID>FA01-00000001</cbc:ID><cbc:IssueDate>2022-10-15</cbc:IssueDate><cbc:IssueTime>19:28:28.2980000Z</cbc:IssueTime><cbc:DueDate>2022-10-15</cbc:DueDate><cbc:InvoiceTypeCode listID=\"0101\">01</cbc:InvoiceTypeCode><cbc:Note languageLocaleID=\"1000\">MONTO EN SOLES</cbc:Note><cbc:DocumentCurrencyCode>PEN</cbc:DocumentCurrencyCode><cac:Signature><cbc:ID>20606022779</cbc:ID><cbc:Note>Mabe by SWIFTLINE SAC</cbc:Note><cac:SignatoryParty><cac:PartyIdentification><cbc:ID>20606022779</cbc:ID></cac:PartyIdentification><cac:PartyName><cbc:Name>SWIFTLINE SAC</cbc:Name></cac:PartyName></cac:SignatoryParty></cac:Signature><cac:AccountingSupplierParty><cac:Party><cac:PartyIdentification><cbc:ID schemeID=\"6\">20606022779</cbc:ID></cac:PartyIdentification><cac:PartyName><cbc:Name>SWIFTLINE SAC</cbc:Name></cac:PartyName><cac:PartyLegalEntity><cbc:RegistrationName>20606022779</cbc:RegistrationName><cac:RegistrationAddress><cbc:ID>220901</cbc:ID><cbc:AddressTypeCode>0000</cbc:AddressTypeCode><cbc:CityName>SAN MARTIN</cbc:CityName><cbc:CountrySubentity>SAN MARTIN</cbc:CountrySubentity><cbc:District>TARAPOTO</cbc:District><cac:AddressLine><cbc:Line>PSJE. LIMATAMBO 121</cbc:Line></cac:AddressLine><cac:Country><cbc:IdentificationCode>PE</cbc:IdentificationCode></cac:Country></cac:RegistrationAddress></cac:PartyLegalEntity></cac:Party></cac:AccountingSupplierParty><cac:AccountingCustomerParty><cac:Party><cac:PartyIdentification><cbc:ID schemeID=\"6\">20450150844</cbc:ID></cac:PartyIdentification><cac:PartyLegalEntity><cbc:RegistrationName>EDUCOM SAC</cbc:RegistrationName><cac:RegistrationAddress><cac:AddressLine><cbc:Line>PSJE. LIMATAMBO 121, TARAPOTO, SAN MARTIN</cbc:Line></cac:AddressLine></cac:RegistrationAddress></cac:PartyLegalEntity></cac:Party></cac:AccountingCustomerParty><cac:PaymentTerms><cbc:ID>FormaPago</cbc:ID><cbc:PaymentMeansID>Contado</cbc:PaymentMeansID></cac:PaymentTerms><cac:TaxTotal><cbc:TaxAmount currencyID=\"PEN\">3.6</cbc:TaxAmount><cac:TaxSubtotal><cbc:TaxableAmount currencyID=\"PEN\">20</cbc:TaxableAmount><cbc:TaxAmount currencyID=\"PEN\">3.6</cbc:TaxAmount><cac:TaxCategory><cac:TaxScheme><cbc:ID>1000</cbc:ID><cbc:Name>IGV</cbc:Name><cbc:TaxTypeCode>VAT</cbc:TaxTypeCode></cac:TaxScheme></cac:TaxCategory></cac:TaxSubtotal></cac:TaxTotal><cac:LegalMonetaryTotal><cbc:LineExtensionAmount currencyID=\"PEN\">20</cbc:LineExtensionAmount><cbc:TaxInclusiveAmount currencyID=\"PEN\">23.6</cbc:TaxInclusiveAmount><cbc:AllowanceTotalAmount currencyID=\"PEN\">0</cbc:AllowanceTotalAmount><cbc:ChargeTotalAmount currencyID=\"PEN\">0</cbc:ChargeTotalAmount><cbc:PrepaidAmount currencyID=\"PEN\">0</cbc:PrepaidAmount><cbc:PayableAmount currencyID=\"PEN\">23.6</cbc:PayableAmount></cac:LegalMonetaryTotal><cac:InvoiceLine><cbc:ID>1</cbc:ID><cbc:InvoicedQuantity unitCode=\"NIU\">1</cbc:InvoicedQuantity><cbc:LineExtensionAmount currencyID=\"PEN\">20</cbc:LineExtensionAmount><cac:PricingReference><cac:AlternativeConditionPrice><cbc:PriceAmount currencyID=\"PEN\">23.6</cbc:PriceAmount><cbc:PriceTypeCode>01</cbc:PriceTypeCode></cac:AlternativeConditionPrice></cac:PricingReference><cac:TaxTotal><cbc:TaxAmount currencyID=\"PEN\">3.6</cbc:TaxAmount><cac:TaxSubtotal><cbc:TaxableAmount currencyID=\"PEN\">20</cbc:TaxableAmount><cbc:TaxAmount currencyID=\"PEN\">3.6</cbc:TaxAmount><cac:TaxCategory><cbc:Percent>18</cbc:Percent><cbc:TaxExemptionReasonCode>10</cbc:TaxExemptionReasonCode><cac:TaxScheme><cbc:ID>1000</cbc:ID><cbc:Name>IGV</cbc:Name><cbc:TaxTypeCode>VAT</cbc:TaxTypeCode></cac:TaxScheme></cac:TaxCategory></cac:TaxSubtotal></cac:TaxTotal><cac:Item><cbc:Description>Teclado Generico Logitech</cbc:Description><cac:SellersItemIdentification><cbc:ID>1</cbc:ID></cac:SellersItemIdentification><cac:CommodityClassification><cbc:ItemClassificationCode listID=\"UNSPSC\" listAgencyName=\"GS1 US\" listName=\"Item Classification\">25172405</cbc:ItemClassificationCode></cac:CommodityClassification></cac:Item><cac:Price><cbc:PriceAmount currencyID=\"PEN\">20</cbc:PriceAmount></cac:Price></cac:InvoiceLine></Invoice>";
        var issuer = _fixture.Create<Issuer>();
        var documentType = "01";
        var certBase64 = "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";
        issuer.BetaCertificatePasword = "20606022779";
        issuer.BetaCertificate = Convert.FromBase64String(certBase64);

        //Act
        var sut = _sunatService.SignXml(xml, issuer, documentType);

        //Assert
        Assert.NotNull(sut);
        Assert.IsType<XmlDocument>(sut);
    }

    [Fact]
    public void SunatService_ZipXmlTest()
    {
        //Arrange
        var xmlDoc = new XmlDocument();
        xmlDoc.LoadXml("<?xml version=\"1.0\" encoding=\"utf-16\"?><Invoice xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:cac=\"urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2\" xmlns:cbc=\"urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2\" xmlns:ccts=\"urn:un:unece:uncefact:documentation:2\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:ext=\"urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2\" xmlns:qdt=\"urn:oasis:names:specification:ubl:schema:xsd:QualifiedDatatypes-2\" xmlns:udt=\"urn:un:unece:uncefact:data:specification:UnqualifiedDataTypesSchemaModule:2\" xmlns=\"urn:oasis:names:specification:ubl:schema:xsd:Invoice-2\"><ext:UBLExtensions><ext:UBLExtension> <ext:ExtensionContent><ds:Signature Id=\"SignSUNAT\"><SignedInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><Reference URI=\"\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>XYPAYJ1GtdLQkCx3u1RSdbQgseul4U/E82Z9ExL0hPg=</DigestValue></Reference></SignedInfo><SignatureValue xmlns=\"http://www.w3.org/2000/09/xmldsig#\">uh/W4GE62hvCneaYX+twM3gyoLW6o5/+FUgzi91W9JMs2VB67fAvAo4hl2v2Ahal4qv5WgDIhVjwIMbEJZra2x+7q8u/nrf0Bc49wM6mRitoFTVHT8OoK2K8LxJhP4q5iPRSCuxegUvNMd6hebGoNducPNGAyM0n6anXiZoifcx2WmHTR71cyigUfqPAqMCm8HvPutu8Jm/FHs5mxgO+7cYZ8FHlrMhwPnn90ED55IaYIzIOobaabd17KSd1lJGAMjJpHGzAONUNSS60XU8uJfnsalgqu99F2zQfqcDDiPrit0mD8o8a6EH9ljt23Sap0MFWY+ckGP/z1VR5zDFO8w==</SignatureValue><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509SubjectName>E=demo@llama.pe, CN=NOMBRE REPRESENTANTE LEGAL - CERTIFICADO PARA DEMOSTRACIÓN, OU=DNI 9999999 RUC 20606022779 - CERTIFICADO PARA DEMOSTRACIÓN, O=TU EMPRESA S.A., L=LIMA, S=LIMA, C=PE, DC=LLAMA.PE SA</X509SubjectName><X509Certificate>MIIFCDCCA/CgAwIBAgIJANR7qWRxreexMA0GCSqGSIb3DQEBCwUAMIIBDTEbMBkGCgmSJomT8ixkARkWC0xMQU1BLlBFIFNBMQswCQYDVQQGEwJQRTENMAsGA1UECAwETElNQTENMAsGA1UEBwwETElNQTEYMBYGA1UECgwPVFUgRU1QUkVTQSBTLkEuMUUwQwYDVQQLDDxETkkgOTk5OTk5OSBSVUMgMjA2MDYwMjI3NzkgLSBDRVJUSUZJQ0FETyBQQVJBIERFTU9TVFJBQ0nDk04xRDBCBgNVBAMMO05PTUJSRSBSRVBSRVNFTlRBTlRFIExFR0FMIC0gQ0VSVElGSUNBRE8gUEFSQSBERU1PU1RSQUNJw5NOMRwwGgYJKoZIhvcNAQkBFg1kZW1vQGxsYW1hLnBlMB4XDTIyMTAwNTE5MzgyMloXDTI0MTAwNDE5MzgyMlowggENMRswGQYKCZImiZPyLGQBGRYLTExBTUEuUEUgU0ExCzAJBgNVBAYTAlBFMQ0wCwYDVQQIDARMSU1BMQ0wCwYDVQQHDARMSU1BMRgwFgYDVQQKDA9UVSBFTVBSRVNBIFMuQS4xRTBDBgNVBAsMPEROSSA5OTk5OTk5IFJVQyAyMDYwNjAyMjc3OSAtIENFUlRJRklDQURPIFBBUkEgREVNT1NUUkFDScOTTjFEMEIGA1UEAww7Tk9NQlJFIFJFUFJFU0VOVEFOVEUgTEVHQUwgLSBDRVJUSUZJQ0FETyBQQVJBIERFTU9TVFJBQ0nDk04xHDAaBgkqhkiG9w0BCQEWDWRlbW9AbGxhbWEucGUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC/P6G4EKmPA8542sqfRG26DH4a/slKLw9haqD0HyUqyn+xPkYm6Jc87WHhCLqaexkn5bJzEsqpZkV5/gHhs4qMkXeSArtTmu2RKQ16NoVfOzOszzyVEdZ/mqDeaPTVaDOIpeXdwCtWyYHTcHznP7AFSuivR5cKEO1p8zN/yB9jYyeT1Z8zf3OmcaKrzPjIvzJgM+NirPL1kOUGlKs1ZTe6MNkrNelF2ZqR5LIJWdWB6kOQXFMPF34l52tVIWHqIVjbOz6Je8NCEy/T+BjSZK2igPmEXC23GiD8q/LylO2IeddQ3K53EZKWzJX5O5EohaukpengcoMKFGT0g+TBHL8/AgMBAAGjZzBlMB0GA1UdDgQWBBR7sP74vTIIILVzLIyPqtXXuGIcLzAfBgNVHSMEGDAWgBR7sP74vTIIILVzLIyPqtXXuGIcLzATBgNVHSUEDDAKBggrBgEFBQcDATAOBgNVHQ8BAf8EBAMCB4AwDQYJKoZIhvcNAQELBQADggEBAAZjOR23wD7onC4xQoKNZQFzF5eodR4QA2n4+2PXJPW7kIFF+xZLdV2ENU93m49u+p9qDE9uK0QQUW7B8hYrZp37BR9Nw8CAGcwOqVQgAs6PubHNU7C2a0vM8eRcEam9pVn3i0MemVS5kOF2WDQvvzYkk9xOUqNAhZelkpa73sn3YckGTV5ltXKSMzAFlx0EJYIRC5u2x3MzxVtkFX7OQcvRftNmrQnV878vXKW+kw6uJIhXFjor//yzH3eLfs5N8OoCoKDrmQSZ5cz1UXQu7Ftlw6q7eAFSsRH05n9ZJJwXvM9cq909hce5LnkDoGkj8N72AicKcJz2WVw2SiIgzH8=</X509Certificate></X509Data></KeyInfo></ds:Signature></ext:ExtensionContent></ext:UBLExtension></ext:UBLExtensions><cbc:UBLVersionID>2.1</cbc:UBLVersionID><cbc:CustomizationID>2.0</cbc:CustomizationID><cbc:ID>FA01-00000001</cbc:ID><cbc:IssueDate>2022-10-15</cbc:IssueDate><cbc:IssueTime>19:28:28.2980000Z</cbc:IssueTime><cbc:DueDate>2022-10-15</cbc:DueDate><cbc:InvoiceTypeCode listID=\"0101\">01</cbc:InvoiceTypeCode><cbc:Note languageLocaleID=\"1000\">MONTO EN SOLES</cbc:Note><cbc:DocumentCurrencyCode>PEN</cbc:DocumentCurrencyCode><cac:Signature><cbc:ID>20606022779</cbc:ID><cbc:Note>Mabe by SWIFTLINE SAC</cbc:Note><cac:SignatoryParty><cac:PartyIdentification><cbc:ID>20606022779</cbc:ID></cac:PartyIdentification><cac:PartyName><cbc:Name>SWIFTLINE SAC</cbc:Name></cac:PartyName></cac:SignatoryParty></cac:Signature><cac:AccountingSupplierParty><cac:Party><cac:PartyIdentification><cbc:ID schemeID=\"6\">20606022779</cbc:ID></cac:PartyIdentification><cac:PartyName><cbc:Name>SWIFTLINE SAC</cbc:Name></cac:PartyName><cac:PartyLegalEntity><cbc:RegistrationName>20606022779</cbc:RegistrationName><cac:RegistrationAddress><cbc:ID>220901</cbc:ID><cbc:AddressTypeCode>0000</cbc:AddressTypeCode><cbc:CityName>SAN MARTIN</cbc:CityName><cbc:CountrySubentity>SAN MARTIN</cbc:CountrySubentity><cbc:District>TARAPOTO</cbc:District><cac:AddressLine><cbc:Line>PSJE. LIMATAMBO 121</cbc:Line></cac:AddressLine><cac:Country><cbc:IdentificationCode>PE</cbc:IdentificationCode></cac:Country></cac:RegistrationAddress></cac:PartyLegalEntity></cac:Party></cac:AccountingSupplierParty><cac:AccountingCustomerParty><cac:Party><cac:PartyIdentification><cbc:ID schemeID=\"6\">20450150844</cbc:ID></cac:PartyIdentification><cac:PartyLegalEntity><cbc:RegistrationName>EDUCOM SAC</cbc:RegistrationName><cac:RegistrationAddress><cac:AddressLine><cbc:Line>PSJE. LIMATAMBO 121, TARAPOTO, SAN MARTIN</cbc:Line></cac:AddressLine></cac:RegistrationAddress></cac:PartyLegalEntity></cac:Party></cac:AccountingCustomerParty><cac:PaymentTerms><cbc:ID>FormaPago</cbc:ID><cbc:PaymentMeansID>Contado</cbc:PaymentMeansID></cac:PaymentTerms><cac:TaxTotal><cbc:TaxAmount currencyID=\"PEN\">3.6</cbc:TaxAmount><cac:TaxSubtotal><cbc:TaxableAmount currencyID=\"PEN\">20</cbc:TaxableAmount><cbc:TaxAmount currencyID=\"PEN\">3.6</cbc:TaxAmount><cac:TaxCategory><cac:TaxScheme><cbc:ID>1000</cbc:ID><cbc:Name>IGV</cbc:Name><cbc:TaxTypeCode>VAT</cbc:TaxTypeCode></cac:TaxScheme></cac:TaxCategory></cac:TaxSubtotal></cac:TaxTotal><cac:LegalMonetaryTotal><cbc:LineExtensionAmount currencyID=\"PEN\">20</cbc:LineExtensionAmount><cbc:TaxInclusiveAmount currencyID=\"PEN\">23.6</cbc:TaxInclusiveAmount><cbc:AllowanceTotalAmount currencyID=\"PEN\">0</cbc:AllowanceTotalAmount><cbc:ChargeTotalAmount currencyID=\"PEN\">0</cbc:ChargeTotalAmount><cbc:PrepaidAmount currencyID=\"PEN\">0</cbc:PrepaidAmount><cbc:PayableAmount currencyID=\"PEN\">23.6</cbc:PayableAmount></cac:LegalMonetaryTotal><cac:InvoiceLine><cbc:ID>1</cbc:ID><cbc:InvoicedQuantity unitCode=\"NIU\">1</cbc:InvoicedQuantity><cbc:LineExtensionAmount currencyID=\"PEN\">20</cbc:LineExtensionAmount><cac:PricingReference><cac:AlternativeConditionPrice><cbc:PriceAmount currencyID=\"PEN\">23.6</cbc:PriceAmount><cbc:PriceTypeCode>01</cbc:PriceTypeCode></cac:AlternativeConditionPrice></cac:PricingReference><cac:TaxTotal><cbc:TaxAmount currencyID=\"PEN\">3.6</cbc:TaxAmount><cac:TaxSubtotal><cbc:TaxableAmount currencyID=\"PEN\">20</cbc:TaxableAmount><cbc:TaxAmount currencyID=\"PEN\">3.6</cbc:TaxAmount><cac:TaxCategory><cbc:Percent>18</cbc:Percent><cbc:TaxExemptionReasonCode>10</cbc:TaxExemptionReasonCode><cac:TaxScheme><cbc:ID>1000</cbc:ID><cbc:Name>IGV</cbc:Name><cbc:TaxTypeCode>VAT</cbc:TaxTypeCode></cac:TaxScheme></cac:TaxCategory></cac:TaxSubtotal></cac:TaxTotal><cac:Item><cbc:Description>Teclado Generico Logitech</cbc:Description><cac:SellersItemIdentification><cbc:ID>1</cbc:ID></cac:SellersItemIdentification><cac:CommodityClassification><cbc:ItemClassificationCode listID=\"UNSPSC\" listAgencyName=\"GS1 US\" listName=\"Item Classification\">25172405</cbc:ItemClassificationCode></cac:CommodityClassification></cac:Item><cac:Price><cbc:PriceAmount currencyID=\"PEN\">20</cbc:PriceAmount></cac:Price></cac:InvoiceLine></Invoice>");

        //Act
        var sut = _sunatService.ZipXml(xmlDoc, _fixture.Create<string>());

        //Assert
        Assert.NotNull(sut);
        Assert.IsType<byte[]>(sut);
    }

    [Fact]
    public async Task SunatService_SendBillTest()
    {
        //Arrange
        var zippedXml = "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";
        var byteZippedXml = Convert.FromBase64String(zippedXml);

        //Act
        var sut = await _sunatService.SendBill("https://e-beta.sunat.gob.pe/ol-ti-itcpfegem-beta/billService",
                "20606022779MODDATOS",
                "moddatos",
                "20606022779-01-FA01-00000001.zip",
                byteZippedXml);

        //Assert
        Assert.NotNull(sut);
        Assert.IsType<byte[]>(sut);
    }

    [Fact]
    public async Task SunatService_SendSummaryTest()
    {
        //Arrange
        var zippedXml = "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";
        var byteZippedXml = Convert.FromBase64String(zippedXml);

        //Act
        var sut = await _sunatService.SendSummary("https://e-beta.sunat.gob.pe/ol-ti-itcpfegem-beta/billService",
                "20606022779MODDATOS",
                "moddatos",
                "20606022779-RC-20221029-00001.zip",
                byteZippedXml);

        //Assert
        Assert.NotNull(sut);
        Assert.IsType<string>(sut);
    }

    [Fact]
    public async Task SunatService_GetStatusTest()
    {
        //Arrange
        var ticketNumber = "1667101787029";

        //Act
        var sut = await _sunatService.GetStatus("https://e-beta.sunat.gob.pe/ol-ti-itcpfegem-beta/billService",
                "20606022779MODDATOS",
                "moddatos",
                ticketNumber);

        //Assert
        Assert.NotNull(sut);
        Assert.IsType<Tuple<string, byte[]>>(sut);
    }

    [Fact]
    public void SunatService_ReadResponseTest()
    {
        //Arrange
        var base64Response = "UEsDBBQAAgAIAA92VVUAAAAAAgAAAAAAAAAGAAAAZHVtbXkvAwBQSwMEFAACAAgAD3ZVVSklDkM8BAAALg0AACIAAABSLTIwNjA2MDIyNzc5LTAxLUZBMDEtMDAwMDAwMDEueG1stVddc9o6EH3vr/DAQ2c615FtPkI8Dh0SLi0J5SZ8tL2Piq0YT23JI8mE5NfflYWNTZxp6MwFHuTds2d3j1by4H3eJbGxJVxEjF627DOrZRDqsyCi4WVrvZqYg9bn4QcPc3eUpnHkYwnABREpo4IYEEzFZSvj1GVYRMKlOCHCFSnxo8c92M0eYlf4G5JgdycCd0q3LPKJ6bR0uIv5iQwNlRzYyE6eSHfNkoTRv3eSUKUCPAIloVIcSP0H/49IrwDuNxLiPyMchSEnIZakiTSArdhImboIPT09nT11zhgPkWNZFrIuEGACEYXtAi0YTku8TiTOwKXseaBaIEK3JGYpQWUSSF6GkZ2IZQ5WZmFiGpgygl7KJEWfIqNYvtlnSnhWbXap0E292gXx7q1ebfTz22yZUxVYYCG7tKFocGQx5iZ4ORFq80Vr6MEEueurWTkQohjzBp+2VGaHwkoOvWUUQgcZL4/IO/YFjpkKI8GUPrLhB8PwrjFlFHSKo5dcq29EblhgjOKQ8UhukjclsC1FC335pm93afsHoNUAKQ1bKOcuK3w3qdUtajUTxkmbC2yKDe7Zzp5yQR4Jh9uDGOvFVMkFRjCvOKbikfFEaEPV9Nu0NYmKYQxMUVSvU59I+h6BgBAdV+6No5AIeaJioEi7qlPJ8x3HGRk+r2++7BBefg2SWXoer3uD3W04GWT+7eBhMPqFZ4tRcHO/WZEpv56H6x/96KX3NeSD9Tx9kbf3Qedm2f0nm/07sSe401uE24l4eby/vPRQNYvaH1RuEIwaqs9adSJ0xKc7Hm3h9Bm/yLPx8YpIfAdHFa4zwuVHgzJpZOknTVOJ8m7Jc87p/exZF2MssV6pKH3mgXkO10Bg+AfTnl8nBIYK/3FwzjYVIiN8SXiE46pFEZ9OX4nNuTTvPEseCD+drRZdTVCUiw7KoFKtg46wbr5T0OvL55VJDD14VynTd/1On46HzpnloVfWHHedCcmS/e0CRruAHjtytAL0+/3OwD637a7V0dDSq5ocqy1yLMcxbcu0eyv7wnUG8NtDS8ghYgWvi6FlufmvAsvtOax4x9e4HVtja84aPCewu2534HaOwHtu7LsV1fe9KMtyPR+tKt2VQMaf7zCXz9qWL6cBbE75NitpHMvuwNe56PUOROjtqMKhp1AF5KtKJdqDjpDoreLg8EcSx2WDIymxv0nySVJ+NTKc4vhwJ+jJWUyH7SMNlE0naghCv0uGjnVWj4QGhP8/UqLGBAvik2h7Qs4+fB3n/Pzi3TkbUoyZnykVisEraimf8qHcawkpJiPLNi39KWf24K7N9zUL4ODUBzu35agxET6P0ry8GTYm2Af1sUGhHM6MWp6/jA02RBQwA/sklTjAmrRKUXRYbePQXG2Cmtso9WuK0uJFaQT2d25Q33Ssbs+ye9ag2z1li2pZUPMmoea/O8P/AFBLAQIAABQAAgAIAA92VVUAAAAAAgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAABkdW1teS9QSwECAAAUAAIACAAPdlVVKSUOQzwEAAAuDQAAIgAAAAAAAAABAAAAAAAmAAAAUi0yMDYwNjAyMjc3OS0wMS1GQTAxLTAwMDAwMDAxLnhtbFBLBQYAAAAAAgACAIQAAACiBAAAAAA=";
        var byteResponse = Convert.FromBase64String(base64Response);

        //Act
        var sut = _sunatService.ReadResponse(byteResponse);

        //Assert
        Assert.NotNull(sut);
        Assert.IsType<List<string>>(sut);
        Assert.Contains("aceptada", sut[0]);
    }
}